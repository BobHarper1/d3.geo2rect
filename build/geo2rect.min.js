!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.geo2rect=t.geo2rect||{})}(this,function(t){"use strict";var e=function(t){function e(t){for(var e=-Number.MAX_VALUE,i=null,o=0;o<t.coordinates.length;o++){var r=turf.area({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:"MultiPolygon"===t.type?[t.coordinates[o][0]]:[t.coordinates[o]]}});r>e&&(e=r,i=o)}return["MultiPolygon"===t.type?t.coordinates[i][0]:t.coordinates[i]]}return t.features.forEach(function(t,i){t.geometry.ocoordinates=t.geometry.coordinates,"MultiPolygon"===t.geometry.type&&(t.geometry.coordinates=e(t.geometry),t.geometry.type="Polygon"),t.geometry.coordinates.length>1&&(t.geometry.coordinates=e(t.geometry));var o=turf.bbox(t);t.geometry.centroid=[(o[2]-o[0])/2+o[0],(o[1]-o[3])/2+o[3]];var r=o[3]-o[1],n=o[2]-o[0],s=[[n/3+o[0],o[3]],[n/3+o[0]+n/3,o[3]],[o[2],r/2+o[1]],[n/3+o[0]+n/3,o[1]],[n/3+o[0],o[1]],[o[0],r/2+o[1]]];if(t.geometry.coordinates[0].length<4)for(;t.geometry.coordinates[0].length<4;)t.geometry.coordinates[0].push(t.geometry.coordinates[0][0]);var a=t.geometry.coordinates[0],h=[];if("hex"===config.shapes)for(var c=0;c<6;c++)!function(t){var e=void 0,i=Number.MAX_VALUE,o=void 0;switch(t){case 0:o=s[0];break;case 1:o=s[1];break;case 2:o=s[2];break;case 3:o=s[3];break;case 4:o=s[4];break;case 5:o=s[5]}if(a.forEach(function(t,r){var n=Math.abs(Math.sqrt(Math.pow(o[0]-t[0],2)+Math.pow(o[1]-t[1],2)));n<i&&(r<h[0]||r>h[h.length-1]||0===h.length)&&(i=n,e=r)}),h.length>=1){var r=0;if(h.length>=2)for(var n=1;n<h.length;n++){var c=h[n],g=h[n-1];r+=g<c?c-g:c+(a.length-g)}var f=h[h.length-1],_=e,d=void 0;d=f<_?_-f:_+(a.length-f),a.length-d-r<6-t&&(e-=-t)<0&&(e+=a.length)}h.push(e)}(c);else for(var g=0;g<4;g++)!function(t){var e=void 0,i=Number.MAX_VALUE,r=void 0;switch(t){case 0:r=[o[0],o[3]];break;case 1:r=[o[2],o[3]];break;case 2:r=[o[2],o[1]];break;case 3:r=[o[0],o[1]]}if(a.forEach(function(t,o){var n=Math.abs(Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)));n<i&&(o<h[0]||o>h[h.length-1]||0===h.length)&&(i=n,e=o)}),h.length>=1){var n=0;if(h.length>=2)for(var s=1;s<h.length;s++){var c=h[s],g=h[s-1];n+=g<c?c-g:c+(a.length-g)}var f=h[h.length-1],_=e,d=void 0;d=f<_?_-f:_+(a.length-f),a.length-d-n<4-t&&(e-=4-t)<0&&(e+=a.length)}h.push(e)}(g);var f={};if("hex"===config.shapes)for(var _=0;_<6;_++){var d=void 0,l=void 0,u=void 0,v=void 0;switch(_){case 0:u=.25,v=.07,d=s[0],l=s[1];break;case 1:u=.75,v=.07,d=s[1],l=s[2];break;case 2:u=1,v=.5,d=s[2],l=s[3];break;case 3:u=.75,v=.93,d=s[3],l=s[4];break;case 4:u=.25,v=.93,l=s[4],d=s[5];break;case 5:u=0,v=.5,d=s[5],l=s[0]}var p=l[0]-d[0],y=l[1]-d[1];0!=p&&(p/=Math.abs(p)),0!=y&&(y/=Math.abs(y)),y*=-1;var m=h[_],w=_===h.length-1?h[0]:h[_+1],b=void 0;b=m<w?w-m:w+(a.length-m);for(var k=0;k<b;k++){var M=m+k;M>a.length-1&&(M-=a.length),f[M]={c:t.geometry.centroid,x:u,y:v}}}else for(var x=0;x<4;x++){var z=void 0,j=void 0,P=void 0,E=void 0;switch(x){case 0:P=0,E=0,z=[o[0],o[3]],j=[o[2],o[3]];break;case 1:P=1,E=0,z=[o[2],o[3]],j=[o[2],o[1]];break;case 2:P=1,E=1,z=[o[2],o[1]],j=[o[0],o[1]];break;case 3:P=0,E=1,z=[o[0],o[1]],j=[o[0],o[3]]}var A=j[0]-z[0],q=j[1]-z[1];0!=A&&(A/=Math.abs(A)),0!=q&&(q/=Math.abs(q)),q*=-1;var L=h[x],N=x===h.length-1?h[0]:h[x+1],U=void 0;U=L<N?N-L:N+(a.length-L);for(var V=0;V<U;V++){var X=L+V;X>a.length-1&&(X-=a.length),f[X]={c:t.geometry.centroid,x:P+A/U*V,y:E+q/U*V}}}t.geometry.qcoordinates=[];for(var C=1;C<a.length;C++)C===a.length-1?t.geometry.qcoordinates.push(f[0]):t.geometry.qcoordinates.push(f[C])}),t},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),r=function(){function t(){i(this,t),this._data=null,this._svg=null,this._col_size=1,this._row_size=1,this._cols=1,this._rows=1,this._init=!1,this._mode="geo",this._rPath=d3.line(),this._path=d3.geoPath(),this._config={width:null,height:null,padding:20,shapes:null,key:null,projection:d3.geoMercator(),grid:null,duration:500}}return o(t,[{key:"update",value:function(){var t=this;if(null!==this._data&&null!==this._config.width&&null!==this._config.height){this._config.projection.center(d3.geoCentroid(this._data)).scale(200).translate([this._config.width/2,this._config.height/2]),this._path.projection(this._config.projection);var e=this._path.bounds(this._data),i=e[1][0]-e[0][0],o=e[1][1]-e[0][1],r=Math.max(1,.9/Math.max(i/(this._config.width-2*this._config.padding),o/(this._config.height-2*this._config.padding)));this._config.projection.scale(200*r),this._data.features.forEach(function(e){e.geometry.qcoordinates.forEach(function(e){var i=t._config.projection(e.c);e.pc=i})});var n=this;this._rPath.x(function(t){return(t.x-.5)*n._col_size+t.pc[0]}).y(function(t){return(t.y-.5)*n._row_size+t.pc[1]})}this._init=!0}},{key:"draw",value:function(){if(this._init){var t=this,e=this._svg.selectAll("path").data(this._data.features);e.exit(),e.enter().append("path").attr("class",function(e){return"id-"+t.config.key(e)}),this._svg.selectAll("path").transition().duration(this._config.duration).attr("transform",function(e){var i=0,o=0;if("geo"!=t.mode){var r=t.config.grid[t.config.key(e)],n=t.config.projection(e.geometry.centroid);i=r.ox-n[0],o=r.oy-n[1]}return"translate("+i+","+o+")"}).attr("d",function(e,i){return"geo"===t._mode?t._path(e):t._rPath(e.geometry.qcoordinates)+"Z"})}else console.error("You must run update() first.")}},{key:"toggle",value:function(){"geo"==this._mode?"rect"===this._config.shapes?this._mode="rect":this._mode="hex":this._mode="geo"}},{key:"data",get:function(){return this._data},set:function(t){t&&(this._data=t,this.update())}},{key:"mode",get:function(){return this._mode},set:function(t){t&&(this._mode=t)}},{key:"svg",get:function(){return this._svg},set:function(t){t&&(this._svg=t,this.update())}},{key:"config",get:function(){return this._config},set:function(t){if(t){for(var e in this._config)null!==this._config[e]||e in t?e in t&&(this._config[e]=t[e]):console.error("The config object must provide "+e);o=this._config.grid;for(var i in o)o[i].x+1>this._cols&&(this._cols=o[i].x+1),o[i].y+1>this._rows&&(this._rows=o[i].y+1);this._col_size=(this._config.width-2*this._config.padding)/this._rows,this._row_size=(this._config.height-2*this._config.padding)/this._cols,this._col_size<this._row_size?this._row_size=this._col_size:this._col_size=this._row_size;for(var o in this._config.grid)this._config.grid[o].ox=this._config.width/2-this._cols/2*this._col_size+this._config.grid[o].x*this._col_size+this._col_size/2,"hex"===this._config.shapes&this._config.grid[o].x%2==1?this._config.grid[o].oy=this._config.height/2-this._rows/2*this._row_size+(this._config.grid[o].y+.5)*this._row_size+this._row_size/2:this._config.grid[o].oy=this._config.height/2-this._rows/2*this._row_size+this._config.grid[o].y*this._row_size+this._row_size/2;this.update()}}}]),t}();t.compute=e,t.draw=r,Object.defineProperty(t,"__esModule",{value:!0})});